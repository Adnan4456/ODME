<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>JtreeToGraphPrune.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">SESEditor</a> &gt; <a href="index.source.html" class="el_package">odme.jtreetograph</a> &gt; <span class="el_source">JtreeToGraphPrune.java</span></div><h1>JtreeToGraphPrune.java</h1><pre class="source lang-java linenums">package odme.jtreetograph;

import static odme.jtreetograph.JtreeToGraphVariables.*;

import java.awt.Color;
import java.awt.event.ItemEvent;
import java.awt.event.ItemListener;
import java.awt.event.KeyEvent;
import java.awt.event.KeyListener;
import java.io.File;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.ConcurrentModificationException;

import javax.swing.JComboBox;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.tree.DefaultMutableTreeNode;
import javax.swing.tree.TreeNode;
import javax.swing.tree.TreePath;

import com.google.common.collect.ArrayListMultimap;
import com.google.common.collect.Multimap;
import com.mxgraph.model.mxCell;
import com.mxgraph.util.mxConstants;
import com.mxgraph.util.mxUtils;

import odme.odmeeditor.DynamicTree;
import odme.odmeeditor.Main;
import odme.odmeeditor.ODMEEditor;
import odme.odmeeditor.Variable;

<span class="nc" id="L33">public class JtreeToGraphPrune {</span>

<span class="nc" id="L35">    public static String selectedNodeToPrune = null;</span>
<span class="nc" id="L36">    public static Multimap&lt;TreePath, String&gt; varMapTransfer = ArrayListMultimap.create();</span>

<span class="nc" id="L38">    public static Multimap&lt;TreePath, String&gt; behMapTransfer = ArrayListMultimap.create();</span>
    public static String selecteVarName;

<span class="nc" id="L41">    private static int cellCount = 0;</span>
<span class="nc" id="L42">    private static TreePath[] cellListForIconChange = new TreePath[100];</span>

    public static void pruneNodeFromGraphPopup(Object pos) {

<span class="nc" id="L46">        mxCell selectedCell = (mxCell) pos;</span>
<span class="nc" id="L47">        Object[] outgoing = graph.getOutgoingEdges(selectedCell);</span>

<span class="nc" id="L49">        Object[] incoming = graph.getIncomingEdges(selectedCell);</span>
<span class="nc" id="L50">        Object targetCellIncoming = graph.getModel().getTerminal(incoming[0], true);</span>
<span class="nc" id="L51">        mxCell targetCellIncoming2 = (mxCell) targetCellIncoming;</span>
<span class="nc" id="L52">        int a1 = 0;</span>
<span class="nc" id="L53">        String[] nodeList = new String[outgoing.length+1];</span>
<span class="nc" id="L54">        nodeList[a1] = &quot;Select Node Here:&quot;;</span>
<span class="nc" id="L55">        a1++;</span>

<span class="nc bnc" id="L57" title="All 2 branches missed.">        if (outgoing.length &gt; 0) {</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">            for (int i = 0; i &lt; outgoing.length; i++) {</span>
<span class="nc" id="L59">                Object targetCell = graph.getModel().getTerminal(outgoing[i], false);</span>
<span class="nc" id="L60">                mxCell targetCell2 = (mxCell) targetCell;</span>
<span class="nc" id="L61">                nodeList[a1] = targetCell2.getValue().toString();</span>
<span class="nc" id="L62">                a1++;</span>

            }
        }

        // java 8 way null removal
<span class="nc bnc" id="L68" title="All 4 branches missed.">        nodeList = Arrays.stream(nodeList).filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0)).toArray(String[]::new);</span>

<span class="nc" id="L70">        JComboBox&lt;String&gt; nodeListCombo = new JComboBox&lt;String&gt;(nodeList);</span>

<span class="nc" id="L72">        nodeListCombo.addItemListener(new ItemListener() {</span>
            public void itemStateChanged(ItemEvent event) {
<span class="nc bnc" id="L74" title="All 2 branches missed.">                if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L75">                    selectedNodeToPrune = nodeListCombo.getSelectedItem().toString();</span>
                }
<span class="nc" id="L77">            }</span>
        });

<span class="nc" id="L80">        Object[] pruneOptions = {&quot;Available Options:&quot;, nodeListCombo};</span>

<span class="nc" id="L82">        int option = JOptionPane</span>
<span class="nc" id="L83">                .showConfirmDialog(Main.frame, pruneOptions, &quot;Please Choose from Options&quot;,</span>
                        JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);

<span class="nc bnc" id="L86" title="All 2 branches missed.">        if (option == JOptionPane.OK_OPTION) {</span>
<span class="nc bnc" id="L87" title="All 2 branches missed.">            if (outgoing.length &gt; 0) {</span>
<span class="nc bnc" id="L88" title="All 2 branches missed.">                for (int j = 0; j &lt; outgoing.length; j++) {</span>
<span class="nc" id="L89">                    Object targetCell = graph.getModel().getTerminal(outgoing[j], false);</span>
<span class="nc" id="L90">                    mxCell targetCell2 = (mxCell) targetCell;</span>
<span class="nc bnc" id="L91" title="All 2 branches missed.">                    if (targetCell2.getValue().equals(selectedNodeToPrune)) {</span>
<span class="nc" id="L92">                        Object[] outgoingSelected = graph.getOutgoingEdges(targetCell2);</span>
<span class="nc bnc" id="L93" title="All 2 branches missed.">                        if (outgoingSelected.length &gt; 0) {</span>
<span class="nc" id="L94">                            JtreeToGraphSave.saveModuleFromCurrentModel(targetCell2);</span>
<span class="nc" id="L95">                            JtreeToGraphDelete.deleteNodeFromGraphPopup(pos);</span>
<span class="nc" id="L96">                            String newEntityName =</span>
<span class="nc" id="L97">                                    selectedNodeToPrune + &quot;_&quot; + targetCellIncoming2.getValue().toString();</span>
<span class="nc" id="L98">                            System.out.println(&quot;inside if block&quot;);</span>
<span class="nc" id="L99">                            renameCellPES(targetCellIncoming2, newEntityName);</span>
<span class="nc" id="L100">                            JtreeToGraphAdd.addModuleFromSubgraphUniformity(targetCellIncoming2);</span>
<span class="nc" id="L101">                        } </span>
                        else {
                            /*
                             * Start variable collection. Variables of targetCell2 will be added in
                             * targateCellIncoming2
                             */

<span class="nc" id="L108">                            String[] nodesToSelectedNode = new String[100];</span>
<span class="nc" id="L109">                            String[] nodesBehaviour = new String[100];</span>

<span class="nc" id="L111">                            nodesToSelectedNode = returnAllVariablesFromPrunedNode(targetCell2);</span>

<span class="nc" id="L113">                            nodesBehaviour = returnAllBehaviorVariablesFromPrunedNode(targetCell2);</span>


<span class="nc" id="L116">                            nodesBehaviour = Arrays.stream(nodesBehaviour)</span>
<span class="nc bnc" id="L117" title="All 4 branches missed.">                                    .filter(s -&gt; (s !=null &amp;&amp; s.length() &gt;0)).toArray(String[]::new);</span>

<span class="nc" id="L119">                            nodesToSelectedNode = Arrays.stream(nodesToSelectedNode)</span>
<span class="nc bnc" id="L120" title="All 4 branches missed.">                                    .filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0)).toArray(String[]::new);</span>

<span class="nc" id="L122">                            String[] nodesToSelectedNodeHost = new String[100];</span>
<span class="nc" id="L123">                            String[] nodesToSelectedBehaviorHost = new String[100];</span>
<span class="nc" id="L124">                            nodesToSelectedNodeHost = returnAllVariablesFromPrunedNode(targetCellIncoming2);</span>
<span class="nc" id="L125">                            nodesToSelectedBehaviorHost = returnAllBehaviorVariablesFromPrunedNode(targetCellIncoming2);</span>

<span class="nc" id="L127">                            nodesToSelectedNodeHost = Arrays.stream(nodesToSelectedNodeHost)</span>
<span class="nc bnc" id="L128" title="All 4 branches missed.">                                    .filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0)).toArray(String[]::new);</span>
<span class="nc" id="L129">                            nodesToSelectedBehaviorHost = Arrays.stream(nodesToSelectedBehaviorHost)</span>
<span class="nc bnc" id="L130" title="All 4 branches missed.">                                    .filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0)).toArray(String[]::new);</span>

                            // end of variable collection-------------------

<span class="nc" id="L134">                            JtreeToGraphDelete.deleteNodeFromGraphPopup(pos);</span>
<span class="nc" id="L135">                            String newEntityName =</span>
<span class="nc" id="L136">                                    selectedNodeToPrune + &quot;_&quot; + targetCellIncoming2.getValue().toString();</span>
<span class="nc" id="L137">                            renameCellPES(targetCellIncoming2, newEntityName);</span>


                            //if the node donot have variable but have behavior then for loop will not run.
                            //therefore i am writing different code to transfer behaviors from child node to parent node

<span class="nc bnc" id="L143" title="All 2 branches missed.">                            for(String behavior: nodesBehaviour){</span>
<span class="nc" id="L144">                                addBehaviorFromOneNodeToAnother(targetCellIncoming2 , behavior);</span>
                            }
<span class="nc bnc" id="L146" title="All 2 branches missed.">                            for(String behavior: nodesToSelectedBehaviorHost){</span>
<span class="nc" id="L147">                                addBehaviorFromOneNodeToAnother(targetCellIncoming2 , behavior);</span>
                            }
<span class="nc bnc" id="L149" title="All 2 branches missed.">                            for (String value : nodesToSelectedNode) {</span>
<span class="nc" id="L150">                                 addVariablesFromOneNodeToAnother(targetCellIncoming2, value);</span>
                            }
                        }
                    }
                }
            }
        }
<span class="nc" id="L157">        selectedNodeToPrune = null;</span>
        
<span class="nc" id="L159">        ODMEEditor.changePruneColor();</span>
<span class="nc" id="L160">    }</span>

    public static void pruneMAspNodeFromGraphPopup(Object pos) {
        // Also read the  behaviour List  and update that according to the selection of node.
//        read behaviour file
<span class="nc" id="L165">        mxCell maspcell = (mxCell) pos;</span>
<span class="nc" id="L166">        String maspcellName = maspcell.getValue().toString().replaceAll(&quot;MAsp&quot;, &quot;&quot;);</span>
        
<span class="nc" id="L168">        JTextField nodeListTf = new JTextField(&quot;1&quot;);</span>
<span class="nc" id="L169">        nodeListTf.addKeyListener(new KeyListener() {</span>
            @Override
<span class="nc" id="L171">            public void keyTyped(KeyEvent e) {}</span>

            @Override
            public void keyReleased(KeyEvent e) {
<span class="nc" id="L175">                int n = 1;</span>
                try {
<span class="nc" id="L177">                    n = Integer.parseInt(nodeListTf.getText());</span>
<span class="nc" id="L178">                } catch(NumberFormatException ex){</span>
<span class="nc" id="L179">                    nodeListTf.setText(&quot;&quot;);</span>
<span class="nc" id="L180">                }</span>

<span class="nc bnc" id="L182" title="All 4 branches missed.">                if (n&gt;1000 || n&lt;1) {</span>
<span class="nc" id="L183">                    JOptionPane.showMessageDialog(null, &quot;Number of Entities should be between 1 and 1000&quot;);</span>
<span class="nc" id="L184">                    nodeListTf.setText(&quot;&quot;);</span>
                }
<span class="nc" id="L186">            }</span>

            @Override
<span class="nc" id="L189">            public void keyPressed(KeyEvent e) {}</span>
        });

<span class="nc" id="L192">        Object[] pruneOptions = {&quot;Number of Entities:&quot;, nodeListTf};</span>

<span class="nc" id="L194">        int option = JOptionPane</span>
<span class="nc" id="L195">                .showConfirmDialog(Main.frame, pruneOptions, &quot;Please Choose from Options&quot;,</span>
                        JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);

<span class="nc bnc" id="L198" title="All 2 branches missed.">        if (option == JOptionPane.OK_OPTION) {</span>
<span class="nc bnc" id="L199" title="All 2 branches missed.">            if (nodeListTf.getText().equals(&quot;&quot;)) {</span>
<span class="nc" id="L200">                return;</span>
            }
<span class="nc" id="L202">            int number = Integer.parseInt(nodeListTf.getText());</span>

<span class="nc" id="L204">            JtreeToGraphSave.saveModuleFromCurrentModel(maspcell);</span>

<span class="nc" id="L206">            Object[] incoming = graph.getIncomingEdges(maspcell);</span>
<span class="nc" id="L207">            Object aspectParent = graph.getModel().getTerminal(incoming[0], true);</span>
<span class="nc" id="L208">            mxCell aspectParentNode = (mxCell) aspectParent;</span>
<span class="nc" id="L209">            currentSelectedCell = aspectParentNode;</span>

<span class="nc" id="L211">            JtreeToGraphDelete.deleteNodeFromGraphPopup(maspcell);</span>

<span class="nc" id="L213">            addNodeFromConsolePES(maspcellName + &quot;Dec&quot;);</span>
            
<span class="nc" id="L215">            JtreeToGraphConvert.nodeToRootPath(currentSelectedCell);</span>
<span class="nc" id="L216">            String[] stringArray = path.toArray(new String[0]);</span>
<span class="nc" id="L217">            ArrayList&lt;String&gt; pathRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L219" title="All 2 branches missed.">            for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L220">                pathRev.add(stringArray[i]);</span>
            }

<span class="nc" id="L223">            String[] stringArrayRev = pathRev.toArray(new String[0]);</span>

<span class="nc" id="L225">            JtreeToGraphAdd.addNodeWIthGraphAddition(maspcellName + &quot;Dec&quot;, stringArrayRev);</span>
<span class="nc" id="L226">            path.clear();</span>

<span class="nc" id="L228">            nodeNamesForGraphSync =</span>
<span class="nc bnc" id="L229" title="All 4 branches missed.">                    Arrays.stream(nodeNamesForGraphSync).filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0))</span>
<span class="nc" id="L230">                            .toArray(String[]::new);</span>

<span class="nc" id="L232">            int nodenum = 1;</span>
<span class="nc bnc" id="L233" title="All 2 branches missed.">            for (int i = 0; i &lt; number; i++) {</span>
<span class="nc" id="L234">                addModuleFromSubgraphUniformityPES(currentSelectedCell);</span>

                // for numbering multiple aspect node sequentially after pruning
<span class="nc" id="L237">                Object[] outgoingasp = graph.getOutgoingEdges(currentSelectedCell);</span>
<span class="nc" id="L238">                Object targetCellasp = graph.getModel().getTerminal(outgoingasp[i], false);</span>
<span class="nc" id="L239">                mxCell targetCellasp2 = (mxCell) targetCellasp;</span>
<span class="nc" id="L240">                renameCellPES(targetCellasp2, targetCellasp2.getValue().toString() + &quot;_&quot; + nodenum);</span>

                // if a entity node has aspect node and that entity node is multiaspect node of
                // another then during pruning have to change the aspect node name otherwise in
                // same level there will be two node with same name. solution below.
<span class="nc" id="L245">                Object[] outgoingasp2 = graph.getOutgoingEdges(targetCellasp2);</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">                if (outgoingasp2.length &gt; 0) {</span>
<span class="nc" id="L247">                    targetCellasp = graph.getModel().getTerminal(outgoingasp2[0], false);</span>
<span class="nc" id="L248">                    mxCell targetCellasp3 = (mxCell) targetCellasp;</span>
<span class="nc" id="L249">                    renameCellPES(targetCellasp3, targetCellasp2.getValue().toString() + &quot;Dec&quot;);</span>
                }
<span class="nc" id="L251">                nodenum++;</span>
            }

            /*
             * Copying variables from old node and transfer to new nodes.
             */
            try {

<span class="nc bnc" id="L259" title="All 2 branches missed.">                for (TreePath key : DynamicTree.varMap.keySet()) {</span>
<span class="nc bnc" id="L260" title="All 2 branches missed.">                    for (String value : DynamicTree.varMap.get(key)) {</span>
<span class="nc" id="L261">                        String lastNodeName = key.getLastPathComponent().toString();</span>
<span class="nc" id="L262">                        variableTransferAfterMultiAspectPruning(lastNodeName, value);</span>
<span class="nc" id="L263">                    }</span>
<span class="nc" id="L264">                }</span>

                //copy behaviour of the node to transfer other node
<span class="nc bnc" id="L267" title="All 2 branches missed.">                for (TreePath key : DynamicTree.behavioursList.keySet()) {</span>

<span class="nc bnc" id="L269" title="All 2 branches missed.">                    for (String value : DynamicTree.behavioursList.get(key)) {</span>

//                        System.out.println(&quot; TreePath value = &quot;+value);
<span class="nc" id="L272">                        String lastNodeName = key.getLastPathComponent().toString();</span>
<span class="nc" id="L273">                        behaviourTransferAfterMultiAspectPruning(lastNodeName, value);</span>
//                        DynamicTree.behavioursList.remove(key,value);
<span class="nc" id="L275">                    }</span>
<span class="nc" id="L276">                }</span>
            }
        
<span class="nc" id="L279">            catch (ConcurrentModificationException e) {</span>
<span class="nc" id="L280">                System.out.println(e.getMessage());</span>
<span class="nc" id="L281">            }</span>

            // have to make used array null and count 0 here
<span class="nc" id="L284">            nodeNamesForGraphSync = new String[100]; // or have to delete the added nodes in other way</span>
<span class="nc" id="L285">            treeSyncNodeCount = 0;</span>
<span class="nc" id="L286">            currentSelectedCell = null;</span>

<span class="nc" id="L288">            DynamicTree.behavioursList = behMapTransfer;</span>
<span class="nc" id="L289">            DynamicTree.varMap = varMapTransfer;</span>
        }
<span class="nc" id="L291">        ODMEEditor.changePruneColor();</span>
<span class="nc" id="L292">    }</span>

    /**
     * This function is used to transfer variables which are added during modeling
     * to the final pruned structure after multi-aspect pruned is done.
     *
     * @param lastNodeName
     * @param value
     */


    public static void behaviourTransferAfterMultiAspectPruning(String lastNodeName, String value) {

<span class="nc" id="L305">        Object[] cells = graph.getChildVertices(graph.getDefaultParent());</span>

<span class="nc bnc" id="L307" title="All 2 branches missed.">        for (Object c : cells) {</span>
<span class="nc" id="L308">            mxCell cell2 = (mxCell) c;</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">            if (cell2.isVertex()) {</span>
<span class="nc" id="L310">                String val = (String) cell2.getValue();</span>
<span class="nc bnc" id="L311" title="All 4 branches missed.">                if (val.equals(lastNodeName) || val.startsWith(lastNodeName + &quot;_&quot;)) {</span>

<span class="nc" id="L313">                    pathToRoot.add(val);</span>
<span class="nc" id="L314">                    JtreeToGraphConvert.nodeToRootPathVar(cell2);</span>
<span class="nc" id="L315">                    String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L316">                    ArrayList&lt;String&gt; pathRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L318" title="All 2 branches missed.">                    for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L319">                        pathRev.add(stringArray[i]);</span>
                    }

<span class="nc" id="L322">                    String[] stringArrayRev = pathRev.toArray(new String[0]);</span>
<span class="nc" id="L323">                    TreePath treePathForVariableTransfer = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>

<span class="nc" id="L325">                    int a = 1;</span>
<span class="nc bnc" id="L326" title="All 2 branches missed.">                    for (String v : behMapTransfer.get(treePathForVariableTransfer)) {</span>
<span class="nc bnc" id="L327" title="All 2 branches missed.">                        if (v.equals(value)) {</span>
<span class="nc" id="L328">                            a = 0;</span>
<span class="nc" id="L329">                            break;</span>
                        }
<span class="nc" id="L331">                    }</span>

<span class="nc bnc" id="L333" title="All 2 branches missed.">                    if (a == 1)</span>
<span class="nc" id="L334">                        behMapTransfer.put(treePathForVariableTransfer, value);</span>

<span class="nc" id="L336">                    pathToRoot.clear();</span>
                }
            }
        }
<span class="nc" id="L340">    }</span>


    public static void variableTransferAfterMultiAspectPruning(String lastNodeName, String value) {

<span class="nc" id="L345">        Object[] cells = graph.getChildVertices(graph.getDefaultParent());</span>

<span class="nc bnc" id="L347" title="All 2 branches missed.">        for (Object c : cells) {</span>
<span class="nc" id="L348">            mxCell cell2 = (mxCell) c;</span>
<span class="nc bnc" id="L349" title="All 2 branches missed.">            if (cell2.isVertex()) {</span>
<span class="nc" id="L350">                String val = (String) cell2.getValue();</span>
<span class="nc bnc" id="L351" title="All 4 branches missed.">                if (val.equals(lastNodeName) || val.startsWith(lastNodeName + &quot;_&quot;)) {</span>

<span class="nc" id="L353">                    pathToRoot.add(val);</span>
<span class="nc" id="L354">                    JtreeToGraphConvert.nodeToRootPathVar(cell2);</span>
<span class="nc" id="L355">                    String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L356">                    ArrayList&lt;String&gt; pathRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L358" title="All 2 branches missed.">                    for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L359">                        pathRev.add(stringArray[i]);</span>
                    }

<span class="nc" id="L362">                    String[] stringArrayRev = pathRev.toArray(new String[0]);</span>
<span class="nc" id="L363">                    TreePath treePathForVariableTransfer = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>
                    
<span class="nc" id="L365">                    int a = 1;</span>
<span class="nc bnc" id="L366" title="All 2 branches missed.">                    for (String v : varMapTransfer.get(treePathForVariableTransfer)) {</span>
<span class="nc bnc" id="L367" title="All 2 branches missed.">                        if (v.equals(value)) {</span>
<span class="nc" id="L368">                            a = 0;</span>
<span class="nc" id="L369">                            break;</span>
                        }

<span class="nc" id="L372">                    }</span>

<span class="nc bnc" id="L374" title="All 2 branches missed.">                    if (a == 1)</span>
<span class="nc" id="L375">                        varMapTransfer.put(treePathForVariableTransfer, value);</span>
<span class="nc" id="L376">                    pathToRoot.clear();</span>
                }
            }
        }
<span class="nc" id="L380">    }</span>

    public static void pruneSiblingsFromGraphPopup(Object pos) {
<span class="nc" id="L383">        mxCell selectedCell = (mxCell) pos;</span>

<span class="nc bnc" id="L385" title="All 2 branches missed.">        if (variableList.length == 0) {</span>
<span class="nc" id="L386">            JOptionPane.showMessageDialog(Main.frame, &quot;No variables to prune!&quot;, &quot;Error&quot;,</span>
                    JOptionPane.WARNING_MESSAGE);
<span class="nc" id="L388">            return;</span>
        }
        else {
<span class="nc" id="L391">            selecteVarName = variableList[0].split(&quot;,&quot;)[0];</span>

<span class="nc" id="L393">            JComboBox&lt;String&gt; nodeListCombo = new JComboBox&lt;String&gt;();</span>
<span class="nc bnc" id="L394" title="All 2 branches missed.">            for (int i=0; i&lt;variableList.length; i++) {</span>
<span class="nc bnc" id="L395" title="All 2 branches missed.">                if (variableList[i] != null) {</span>
<span class="nc" id="L396">                    nodeListCombo.addItem(variableList[i].split(&quot;,&quot;)[0]);</span>
                }
            }

<span class="nc" id="L400">            nodeListCombo.addItemListener(new ItemListener() {</span>
                public void itemStateChanged(ItemEvent event) {
<span class="nc bnc" id="L402" title="All 2 branches missed.">                    if (event.getStateChange() == ItemEvent.SELECTED) {</span>
<span class="nc" id="L403">                        selecteVarName = nodeListCombo.getSelectedItem().toString();</span>
                    }
<span class="nc" id="L405">                }</span>
            });

<span class="nc" id="L408">            Object[] pruneOptions = {&quot;Available Options:&quot;, nodeListCombo};</span>

<span class="nc" id="L410">            int option = JOptionPane</span>
<span class="nc" id="L411">                    .showConfirmDialog(Main.frame, pruneOptions, &quot;Please Choose from Options&quot;,</span>
                        JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);

<span class="nc bnc" id="L414" title="All 2 branches missed.">            if (option == JOptionPane.OK_OPTION) {</span>

<span class="nc" id="L416">                String selecteVar = nodeListCombo.getSelectedItem().toString();</span>
<span class="nc bnc" id="L417" title="All 2 branches missed.">                for (String var : variableList) {</span>

<span class="nc bnc" id="L419" title="All 2 branches missed.">                    if (var.split(&quot;,&quot;)[0].equals(selecteVarName)) {</span>
<span class="nc" id="L420">                        selecteVar = var;</span>
<span class="nc" id="L421">                        break;</span>
                    }
                }

<span class="nc bnc" id="L425" title="All 2 branches missed.">                if (selecteVar.split(&quot;,&quot;).length &gt;3)</span>
<span class="nc" id="L426">                    Variable.updateTableData(selectedCell.getValue().toString(), selecteVar.split(&quot;,&quot;)[0], selecteVar.split(&quot;,&quot;)[1],</span>
<span class="nc" id="L427">                            selecteVar.split(&quot;,&quot;)[2], selecteVar.split(&quot;,&quot;)[3], selecteVar.split(&quot;,&quot;)[4]);</span>
                else
<span class="nc" id="L429">                    Variable.updateTableData(selectedCell.getValue().toString(), selecteVar.split(&quot;,&quot;)[0], selecteVar.split(&quot;,&quot;)[1],</span>
<span class="nc" id="L430">                            selecteVar.split(&quot;,&quot;)[2], null, null);</span>
            }
        }
<span class="nc" id="L433">    }</span>


    /**
     * Rename node name of both graph node and jtree node after pruning of
     * specialization node.
     *
     * @param cell
     * @param newName
     */
    public static void renameCellPES(mxCell cell, String newName) {
<span class="nc bnc" id="L444" title="All 2 branches missed.">        if (cell.getId().equals(&quot;rootnode&quot;)) {</span>
<span class="nc" id="L445">            Object[] outgoing = graph.getOutgoingEdges(cell);</span>
            
<span class="nc bnc" id="L447" title="All 2 branches missed.">            if (outgoing.length == 0) {</span>
<span class="nc bnc" id="L448" title="All 4 branches missed.">                if ((newName != null) &amp;&amp; (!newName.trim().isEmpty())) {</span>
                    // jtree
<span class="nc bnc" id="L450" title="All 2 branches missed.">                    if (cell.getId().equals(&quot;rootnode&quot;)) {</span>
                        // assigning new projectname and root to tree
<span class="nc" id="L452">                        DefaultMutableTreeNode rootNode2 = new DefaultMutableTreeNode(newName);</span>
<span class="nc" id="L453">                        DynamicTree.treeModel.setRoot(rootNode2);</span>
<span class="nc" id="L454">                        DynamicTree.treeModel.reload();</span>
                    }
                    // for graph
<span class="nc" id="L457">                    graph.getModel().beginUpdate();</span>
                    try {
<span class="nc" id="L459">                        graph.getModel().setValue(cell, newName);</span>
                    } 
                    finally {
<span class="nc" id="L462">                        graph.getModel().endUpdate();</span>
<span class="nc" id="L463">                    }</span>
                }
            }
            else {
<span class="nc" id="L467">                JOptionPane.showMessageDialog(Main.frame,</span>
                        &quot;You can't rename a root node having child node.&quot;);
            }
<span class="nc" id="L470">        } </span>
        else {
<span class="nc bnc" id="L472" title="All 4 branches missed.">            if ((newName != null) &amp;&amp; (!newName.trim().isEmpty())) {</span>
                // if the new name is not correct then change it according to cell type.
<span class="nc" id="L474">                String currentName = (String) cell.getValue();</span>

<span class="nc bnc" id="L476" title="All 2 branches missed.">                if (currentName.endsWith(&quot;Dec&quot;)) {</span>
<span class="nc bnc" id="L477" title="All 2 branches missed.">                    if (!newName.endsWith(&quot;Dec&quot;)) {</span>
<span class="nc" id="L478">                        newName = newName + &quot;Dec&quot;;</span>
                    }
                } 
<span class="nc bnc" id="L481" title="All 2 branches missed.">                else if (currentName.endsWith(&quot;Spec&quot;)) {</span>
<span class="nc bnc" id="L482" title="All 2 branches missed.">                    if (!newName.endsWith(&quot;Spec&quot;)) {</span>
<span class="nc" id="L483">                        newName = newName + &quot;Spec&quot;;</span>
                    }
                }
<span class="nc bnc" id="L486" title="All 2 branches missed.">                else if (currentName.endsWith(&quot;MAsp&quot;)) {</span>
<span class="nc bnc" id="L487" title="All 2 branches missed.">                    if (!newName.endsWith(&quot;MAsp&quot;)) {</span>
<span class="nc" id="L488">                        newName = newName + &quot;MAsp&quot;;</span>
                    }
                }
                // for jtree

                // if a node is not connected to root then it will not try to change
                // corresponding node name from tree
<span class="nc" id="L495">                JtreeToGraphCheck.checkRootConnectivity(cell);</span>

<span class="nc bnc" id="L497" title="All 2 branches missed.">                if (connectedToRoot) {</span>
<span class="nc" id="L498">                    pathToRoot.add((String) cell.getValue());</span>
<span class="nc" id="L499">                    JtreeToGraphConvert.nodeToRootPathVar(cell);</span>

<span class="nc" id="L501">                    String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L502">                    ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L504" title="All 2 branches missed.">                    for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L505">                        pathToRootRev.add(stringArray[i]);</span>
                    }

<span class="nc" id="L508">                    String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>

<span class="nc" id="L510">                    TreePath treePathForRename = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>

<span class="nc" id="L512">                    DynamicTree.treeModel.valueForPathChanged(treePathForRename, newName);</span>

<span class="nc" id="L514">                    pathToRoot.clear();</span>
                }
<span class="nc" id="L516">                connectedToRoot = false;</span>

                // for graph

<span class="nc" id="L520">                graph.getModel().beginUpdate();</span>
                try {
<span class="nc" id="L522">                    graph.getModel().setValue(cell, newName);</span>
                } 
                finally {
<span class="nc" id="L525">                    graph.getModel().endUpdate();</span>
                }
            }
        }
<span class="nc" id="L529">    }</span>
    public static String[] returnAllBehaviorVariablesFromPrunedNode(mxCell targetCell2){

<span class="nc" id="L532">        String[] nodesToSelectedNode = new String[100];</span>

<span class="nc" id="L534">        pathToRoot.add((String) targetCell2.getValue());</span>
<span class="nc" id="L535">        JtreeToGraphConvert.nodeToRootPathVar(targetCell2);</span>
<span class="nc" id="L536">        String[] stringArray = pathToRoot.toArray(new String[0]);</span>
//        System.out.println(&quot;behavior pathToRoot = &quot;+pathToRoot.toString());
<span class="nc" id="L538">        ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>
<span class="nc bnc" id="L539" title="All 2 branches missed.">        for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
//            System.out.println(&quot;stringArray = &quot;+stringArray[i]);
<span class="nc" id="L541">            pathToRootRev.add(stringArray[i]);</span>
        }

<span class="nc" id="L544">        String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>

<span class="nc" id="L546">        TreePath treePathForVariable = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>

<span class="nc bnc" id="L548" title="All 2 branches missed.">        if (!(treePathForVariable == null)) {</span>
<span class="nc" id="L549">            DefaultMutableTreeNode currentNode =</span>
<span class="nc" id="L550">                    (DefaultMutableTreeNode) (treePathForVariable.getLastPathComponent());</span>

<span class="nc" id="L552">            TreeNode[] nodes = currentNode.getPath();</span>

<span class="nc" id="L554">            int b = 0;</span>

<span class="nc bnc" id="L556" title="All 2 branches missed.">            for (TreePath key : DynamicTree.behavioursList.keySet()) {</span>
<span class="nc" id="L557">                int a = 0;</span>

<span class="nc bnc" id="L559" title="All 2 branches missed.">                for (String value : DynamicTree.behavioursList.get(key)) {</span>

<span class="nc" id="L561">                    DefaultMutableTreeNode currentNode2 =</span>
<span class="nc" id="L562">                            (DefaultMutableTreeNode) (key.getLastPathComponent());</span>

<span class="nc" id="L564">                    TreeNode[] nodes2 = currentNode2.getPath();</span>

<span class="nc bnc" id="L566" title="All 2 branches missed.">                    if (nodes.length == nodes2.length) {</span>

<span class="nc" id="L568">                        int aa = 1;</span>
<span class="nc bnc" id="L569" title="All 2 branches missed.">                        for (int i = 0; i &lt; nodes.length; i++) {</span>

<span class="nc bnc" id="L571" title="All 2 branches missed.">                            if (!nodes[i].toString().equals(nodes2[i].toString())) {</span>
<span class="nc" id="L572">                                aa = 0;</span>
<span class="nc" id="L573">                                break;</span>
                            }
                        }

<span class="nc" id="L577">                        a = aa;</span>
                    }
<span class="nc bnc" id="L579" title="All 2 branches missed.">                    if (a == 1) {</span>
<span class="nc" id="L580">                        nodesToSelectedNode[b] = value;</span>
<span class="nc" id="L581">                        b++;</span>
                    }
<span class="nc" id="L583">                }</span>
<span class="nc" id="L584">            }</span>
        }
<span class="nc" id="L586">        pathToRoot.clear();</span>
<span class="nc bnc" id="L587" title="All 2 branches missed.">        for (String s : nodesToSelectedNode) {</span>
//            System.out.println(&quot;Prune behaviours =&quot;+ s);
        }

<span class="nc" id="L591">        return nodesToSelectedNode;</span>
    }

    private static void addBehaviorFromOneNodeToAnother(mxCell cellForAddingVariable, String behaviorName) {

<span class="nc" id="L596">        pathToRoot.add((String) cellForAddingVariable.getValue());</span>
<span class="nc" id="L597">        JtreeToGraphConvert.nodeToRootPathVar(cellForAddingVariable);</span>

<span class="nc" id="L599">        String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L600">        ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L602" title="All 2 branches missed.">        for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L603">            pathToRootRev.add(stringArray[i]);</span>
        }

<span class="nc" id="L606">        String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>

<span class="nc" id="L608">        TreePath treePathForBehavior = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>

<span class="nc" id="L610">        DynamicTree.behavioursList.put(treePathForBehavior , behaviorName);</span>

<span class="nc" id="L612">        System.out.println(&quot;contains this key = &quot;+DynamicTree.behavioursList.containsKey(treePathForBehavior));</span>

<span class="nc" id="L614">        pathToRoot.clear();</span>

        // have to call a function to refresh the table view
<span class="nc" id="L617">        ODMEEditor.treePanel.showBehavioursInTable(treePathForBehavior);</span>

<span class="nc" id="L619">    }</span>

    public static String[] returnAllVariablesFromPrunedNode(mxCell targetCell2) {
<span class="nc" id="L622">        String[] nodesToSelectedNode = new String[100];</span>

<span class="nc" id="L624">        pathToRoot.add((String) targetCell2.getValue());</span>
<span class="nc" id="L625">        JtreeToGraphConvert.nodeToRootPathVar(targetCell2);</span>

<span class="nc" id="L627">        String[] stringArray = pathToRoot.toArray(new String[0]);</span>

<span class="nc" id="L629">        ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L631" title="All 2 branches missed.">        for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L632">            pathToRootRev.add(stringArray[i]);</span>
        }

<span class="nc" id="L635">        String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>

<span class="nc" id="L637">        TreePath treePathForVariable = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>


<span class="nc bnc" id="L640" title="All 2 branches missed.">        if (!(treePathForVariable == null)) {</span>
<span class="nc" id="L641">            DefaultMutableTreeNode currentNode =</span>
<span class="nc" id="L642">                    (DefaultMutableTreeNode) (treePathForVariable.getLastPathComponent());</span>

<span class="nc" id="L644">            TreeNode[] nodes = currentNode.getPath();</span>

<span class="nc" id="L646">            int b = 0;</span>


<span class="nc bnc" id="L649" title="All 2 branches missed.">            for (TreePath key : DynamicTree.varMap.keySet()) {</span>
<span class="nc" id="L650">                int a = 0;</span>

<span class="nc bnc" id="L652" title="All 2 branches missed.">                for (String value : DynamicTree.varMap.get(key)) {</span>

<span class="nc" id="L654">                    DefaultMutableTreeNode currentNode2 =</span>
<span class="nc" id="L655">                            (DefaultMutableTreeNode) (key.getLastPathComponent());</span>

<span class="nc" id="L657">                    TreeNode[] nodes2 = currentNode2.getPath();</span>

<span class="nc bnc" id="L659" title="All 2 branches missed.">                    if (nodes.length == nodes2.length) {</span>

<span class="nc" id="L661">                        int aa = 1;</span>
<span class="nc bnc" id="L662" title="All 2 branches missed.">                        for (int i = 0; i &lt; nodes.length; i++) {</span>

<span class="nc bnc" id="L664" title="All 2 branches missed.">                            if (!nodes[i].toString().equals(nodes2[i].toString())) {</span>
<span class="nc" id="L665">                                aa = 0;</span>
<span class="nc" id="L666">                                break;</span>
                            }
                        }
//                        System.out.println(&quot;variable to prune = &quot; + value);
<span class="nc" id="L670">                        a = aa;</span>
                    }
<span class="nc bnc" id="L672" title="All 2 branches missed.">                    if (a == 1) {</span>
<span class="nc" id="L673">                        nodesToSelectedNode[b] = value;</span>
//                        System.out.println(&quot;variable to prune = &quot; + value);
<span class="nc" id="L675">                        b++;</span>
                    }
<span class="nc" id="L677">                }</span>
<span class="nc" id="L678">            }</span>
        }
<span class="nc" id="L680">        pathToRoot.clear();</span>
<span class="nc" id="L681">        return nodesToSelectedNode;</span>
    }
    private static void addVariablesFromOneNodeToAnother(mxCell cellForAddingVariable, String variableName) {

<span class="nc" id="L685">        pathToRoot.add((String) cellForAddingVariable.getValue());</span>
<span class="nc" id="L686">        JtreeToGraphConvert.nodeToRootPathVar(cellForAddingVariable);</span>

<span class="nc" id="L688">        String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L689">        ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L691" title="All 2 branches missed.">        for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L692">            pathToRootRev.add(stringArray[i]);</span>
        }

<span class="nc" id="L695">        String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>

<span class="nc" id="L697">        TreePath treePathForVariable = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>
//        System.out.println(&quot;treePathForVariable = &quot;+treePathForVariable);
<span class="nc" id="L699">        DynamicTree.varMap.put(treePathForVariable, variableName);</span>

<span class="nc" id="L701">        pathToRoot.clear();</span>

        // have to call a function to refresh the table view
<span class="nc" id="L704">        ODMEEditor.treePanel.refreshVariableTable(treePathForVariable);</span>
<span class="nc" id="L705">    }</span>

    public static void addNodeFromConsolePES(String nodeName) {
<span class="nc bnc" id="L708" title="All 2 branches missed.">        if (currentSelectedCell != null) {</span>
<span class="nc" id="L709">            mxCell selectedCell = currentSelectedCell;</span>

<span class="nc" id="L711">            Object[] outgoing = graph.getOutgoingEdges(selectedCell);</span>

<span class="nc" id="L713">            mxCell selectedCellNew = null;</span>
<span class="nc" id="L714">            int len = outgoing.length;</span>

            double x;
            double y;

<span class="nc bnc" id="L719" title="All 2 branches missed.">            if (len &gt; 0) {</span>

<span class="nc" id="L721">                Object targetCell = graph.getModel().getTerminal(outgoing[len - 1], false);</span>
<span class="nc" id="L722">                selectedCellNew = (mxCell) targetCell;</span>
<span class="nc" id="L723">                x = selectedCellNew.getGeometry().getX();</span>
<span class="nc" id="L724">                y = selectedCellNew.getGeometry().getY();</span>
<span class="nc" id="L725">                x = x + 100;</span>

                // if the added node manually changed to other position then overlap may happen.
                // for removing that bug have to compare all the child nodes x positions and
                // have to
                // add after the most right one. didn't implement it yet. will do later after
                // first
                // prototype
<span class="nc" id="L733">            }</span>
            else {
<span class="nc" id="L735">                x = selectedCell.getGeometry().getX();</span>
<span class="nc" id="L736">                y = selectedCell.getGeometry().getY();</span>
<span class="nc" id="L737">                y = y + 100;</span>
            }

<span class="nc" id="L740">            graph.getModel().beginUpdate();</span>
            try {
<span class="nc bnc" id="L742" title="All 2 branches missed.">                if (nodeName.endsWith(&quot;Dec&quot;)) {</span>
<span class="nc" id="L743">                    Object obj = graph.insertVertex(parent, null, nodeName, x + 25, y, 30, 30, &quot;Aspect&quot;);</span>
<span class="nc" id="L744">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
                    // lastAddedCell = null; // so that it will not cause duplicate addition in tree
<span class="nc" id="L746">                    nodeNumber++;</span>
<span class="nc" id="L747">                    currentSelectedCell = (mxCell) obj;</span>
<span class="nc" id="L748">                }</span>
<span class="nc bnc" id="L749" title="All 2 branches missed.">                else if (nodeName.endsWith(&quot;MAsp&quot;)) {</span>
<span class="nc" id="L750">                    Object obj = graph.insertVertex(parent, null, nodeName, x + 25, y, 30, 30, &quot;Multiaspect&quot;);</span>
<span class="nc" id="L751">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
                    // lastAddedCell = null; // so that it will not cause duplicate addition in tree
<span class="nc" id="L753">                    nodeNumber++;</span>
<span class="nc" id="L754">                    currentSelectedCell = (mxCell) obj;</span>
<span class="nc" id="L755">                }</span>
<span class="nc bnc" id="L756" title="All 2 branches missed.">                else if (nodeName.endsWith(&quot;Spec&quot;)) {</span>
<span class="nc" id="L757">                    Object obj =</span>
<span class="nc" id="L758">                            graph.insertVertex(parent, null, nodeName, x + 25, y, 30, 30, &quot;Specialization&quot;);</span>
<span class="nc" id="L759">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
                    // lastAddedCell = null; // so that it will not cause duplicate addition in tree
<span class="nc" id="L761">                    nodeNumber++;</span>
<span class="nc" id="L762">                    currentSelectedCell = (mxCell) obj;</span>
<span class="nc" id="L763">                } </span>
                else /* if (DynamicTreeDemo.nodeAddDetector.equals(&quot;entity&quot;)) */ {
<span class="nc" id="L765">                    Object obj = graph.insertVertex(parent, null, nodeName, x, y, 80, 30,</span>
                            &quot;Entity&quot;); // &quot;Aspect;fillColor=#0759cf;strokeColor=white;&quot;);
<span class="nc" id="L767">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
                    // lastAddedCell = null; // so that it will not cause duplicate addition in tree
<span class="nc" id="L769">                    nodeNumber++;</span>
<span class="nc" id="L770">                    currentSelectedCell = (mxCell) obj;</span>
                }
            } 
            finally {
<span class="nc" id="L774">                graph.getModel().endUpdate();</span>

            }
        }
<span class="nc" id="L778">    }</span>
    
    public static void addModuleFromSubgraphUniformityPES(Object obj) {
        // a small tree will be added dynamically to the jtree which is drawn in graph
        // editor and connected later to other node

<span class="nc" id="L784">        Object[] addedNodes = new Object[100];</span>
<span class="nc" id="L785">        int addedNodeCount = 0;</span>
<span class="nc" id="L786">        String[] nodeNameSplits = null;</span>

<span class="nc" id="L788">        String[] nodeNames = new String[100];</span>
<span class="nc" id="L789">        int nodeCount = 0;</span>
<span class="nc" id="L790">        nodeCount = treeSyncNodeCount;</span>
<span class="nc" id="L791">        nodeNames = nodeNamesForGraphSync;</span>

        // deleting null nodes;
<span class="nc" id="L794">        nodeNames =</span>
<span class="nc bnc" id="L795" title="All 4 branches missed.">                Arrays.stream(nodeNames).filter(s -&gt; (s != null &amp;&amp; s.length() &gt; 0)).toArray(String[]::new);</span>

        // adding uniformity node to the array
<span class="nc" id="L798">        addedNodes[addedNodeCount] = obj;</span>
<span class="nc" id="L799">        addedNodeCount++;</span>

<span class="nc bnc" id="L801" title="All 2 branches missed.">        for (int i = 0; i &lt; nodeCount; i++) {</span>
<span class="nc" id="L802">            String nodeName = nodeNames[i];</span>

<span class="nc bnc" id="L804" title="All 2 branches missed.">            if (nodeName.endsWith(&quot;hasparent&quot;)) {</span>
<span class="nc" id="L805">                nodeNameSplits = nodeName.split(&quot;-&quot;);</span>
<span class="nc" id="L806">                nodeName = nodeNameSplits[0];</span>

<span class="nc" id="L808">                String parentNode = nodeNameSplits[1];</span>
<span class="nc bnc" id="L809" title="All 2 branches missed.">                for (Object node : addedNodes) {</span>
<span class="nc bnc" id="L810" title="All 2 branches missed.">                    if (!(node == null)) {</span>
<span class="nc" id="L811">                        mxCell cell = (mxCell) node;</span>
<span class="nc bnc" id="L812" title="All 2 branches missed.">                        if (cell.getValue().equals(parentNode)) {</span>
<span class="nc" id="L813">                            obj = cell;</span>
                        }
                    }
                }
            }

<span class="nc" id="L819">            mxCell selectedCell = (mxCell) obj;</span>

<span class="nc" id="L821">            Object[] outgoing = graph.getOutgoingEdges(selectedCell);</span>

<span class="nc" id="L823">            mxCell selectedCellNew = null;</span>
<span class="nc" id="L824">            int len = outgoing.length;</span>

            double x;
            double y;

<span class="nc bnc" id="L829" title="All 2 branches missed.">            if (len &gt; 0) {</span>

<span class="nc" id="L831">                Object targetCell = graph.getModel().getTerminal(outgoing[len - 1], false);</span>
<span class="nc" id="L832">                selectedCellNew = (mxCell) targetCell;</span>

<span class="nc" id="L834">                x = selectedCellNew.getGeometry().getX();</span>
<span class="nc" id="L835">                y = selectedCellNew.getGeometry().getY();</span>
<span class="nc" id="L836">                x = x + 100;</span>

                // if the added node manually changed to other position then overlap may happen.
                // for removing that bug have to compare all the child nodes x positions and
                // have to
                // add after the most right one. didn't implement it yet. will do later after
                // first
                // prototype
<span class="nc" id="L844">            }</span>
            else {
<span class="nc" id="L846">                x = selectedCell.getGeometry().getX();</span>
<span class="nc" id="L847">                y = selectedCell.getGeometry().getY();</span>
<span class="nc" id="L848">                y = y + 100;</span>
            }

<span class="nc" id="L851">            String nodeId = &quot;pesuniformity&quot; + uniformityNodeNumber;</span>

<span class="nc" id="L853">            graph.getModel().beginUpdate();</span>
            try {
<span class="nc bnc" id="L855" title="All 2 branches missed.">                if (nodeName.endsWith(&quot;Dec&quot;)) {</span>
<span class="nc" id="L856">                    obj = graph.insertVertex(parent, nodeId, nodeName, x + 25, y, 30, 30, &quot;Aspect&quot;);</span>

<span class="nc" id="L858">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
<span class="nc" id="L859">                    lastAddedCell = null; // so that it will not cause duplicate addition in tree</span>

<span class="nc" id="L861">                    uniformityNodeNumber++;</span>

<span class="nc" id="L863">                    addNodeIntoJtreeForSubTree(selectedCell);</span>
                }
<span class="nc bnc" id="L865" title="All 2 branches missed.">                else if (nodeName.endsWith(&quot;MAsp&quot;)) {</span>
<span class="nc" id="L866">                    obj = graph.insertVertex(parent, nodeId, nodeName, x + 25, y, 30, 30, &quot;Multiaspect&quot;);</span>
<span class="nc" id="L867">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
<span class="nc" id="L868">                    lastAddedCell = null;</span>

<span class="nc" id="L870">                    uniformityNodeNumber++;</span>

<span class="nc" id="L872">                    addNodeIntoJtreeForSubTree(selectedCell);</span>
                }
<span class="nc bnc" id="L874" title="All 2 branches missed.">                else if (nodeName.endsWith(&quot;Spec&quot;)) {</span>
<span class="nc" id="L875">                    obj = graph.insertVertex(parent, nodeId, nodeName, x + 25, y, 30, 30, &quot;Specialization&quot;);</span>
<span class="nc" id="L876">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>
<span class="nc" id="L877">                    lastAddedCell = null;</span>

<span class="nc" id="L879">                    uniformityNodeNumber++;</span>

<span class="nc" id="L881">                    addNodeIntoJtreeForSubTree(selectedCell);</span>
                }
                else {
<span class="nc" id="L884">                    obj = graph.insertVertex(parent, nodeId, nodeName, x, y, 80, 30, &quot;Entity&quot;);</span>
<span class="nc" id="L885">                    graph.insertEdge(parent, null, &quot;&quot;, selectedCell, obj);</span>

<span class="nc" id="L887">                    lastAddedCell = null;</span>

<span class="nc" id="L889">                    uniformityNodeNumber++;</span>

<span class="nc" id="L891">                    addNodeIntoJtreeForSubTree(selectedCell);</span>
                }

                // added nodes in the array
<span class="nc" id="L895">                addedNodes[addedNodeCount] = obj;</span>
<span class="nc" id="L896">                addedNodeCount++;</span>
            }
            finally {
<span class="nc" id="L899">                graph.getModel().endUpdate();</span>
            }
        }
<span class="nc" id="L902">    }</span>
    
    public static void addNodeIntoJtreeForSubTree(mxCell lastAddedCell) {
<span class="nc" id="L905">        path.clear();</span>
<span class="nc" id="L906">        mxCell addedCell = null;</span>
<span class="nc bnc" id="L907" title="All 2 branches missed.">        if (lastAddedCell != null) {</span>
<span class="nc" id="L908">            Object[] outgoing = graph.getOutgoingEdges(lastAddedCell);</span>
<span class="nc" id="L909">            Object targetCell = graph.getModel().getTerminal(outgoing[outgoing.length - 1], false);</span>
<span class="nc" id="L910">            addedCell = (mxCell) targetCell;</span>

<span class="nc bnc" id="L912" title="All 2 branches missed.">            if (addedCell != null) {</span>
<span class="nc" id="L913">                JtreeToGraphConvert.nodeToRootPath(addedCell);</span>
<span class="nc" id="L914">                lastAddedCell = null;</span>

                // update jtree
<span class="nc" id="L917">                String[] stringArray = path.toArray(new String[0]);</span>
<span class="nc" id="L918">                ArrayList&lt;String&gt; pathRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L920" title="All 2 branches missed.">                for (int i = stringArray.length - 1; i &gt;= 0; i--) {</span>
<span class="nc" id="L921">                    pathRev.add(stringArray[i]);</span>
                }

<span class="nc" id="L924">                String[] stringArrayRev = pathRev.toArray(new String[0]);</span>

<span class="nc" id="L926">                JtreeToGraphAdd.addNodeWIthGraphAddition(addedCell.getValue().toString(), stringArrayRev);</span>

<span class="nc" id="L928">                path.clear();</span>
            }
        }
<span class="nc" id="L931">    }</span>
    
    /**
     * Find next node of the argument cell. If there is more than one aspect node as
     * a child node of the argument node then it change the color of that node.
     *
     * @param nextnode
     */
    public static void nextChildNode(mxCell nextnode) {
<span class="nc" id="L940">        Object[] outgoing = graph.getOutgoingEdges(nextnode);</span>

<span class="nc bnc" id="L942" title="All 2 branches missed.">        if (outgoing.length == 1) {</span>
<span class="nc" id="L943">            Object targetCell = graph.getModel().getTerminal(outgoing[0], false);</span>
<span class="nc" id="L944">            mxCell targetCell2 = (mxCell) targetCell;</span>
<span class="nc" id="L945">            nextChildNode(targetCell2);</span>
<span class="nc" id="L946">        } </span>
<span class="nc bnc" id="L947" title="All 2 branches missed.">        else if (outgoing.length &gt; 1) {</span>
<span class="nc" id="L948">            int decnum = 0;</span>
<span class="nc bnc" id="L949" title="All 2 branches missed.">            for (int i = 0; i &lt; outgoing.length; i++) {</span>
<span class="nc" id="L950">                Object targetCell = graph.getModel().getTerminal(outgoing[i], false);</span>
<span class="nc" id="L951">                mxCell targetCell2 = (mxCell) targetCell;</span>

<span class="nc bnc" id="L953" title="All 2 branches missed.">                if (targetCell2.getValue().toString().endsWith(&quot;Dec&quot;) || targetCell2.getValue().toString()</span>
<span class="nc bnc" id="L954" title="All 2 branches missed.">                        .endsWith(&quot;MAsp&quot;)) {</span>
<span class="nc" id="L955">                    decnum++;</span>
                }

<span class="nc bnc" id="L958" title="All 2 branches missed.">                if (decnum &gt;= 2) {</span>
<span class="nc" id="L959">                    graph.setCellStyles(mxConstants.STYLE_STROKECOLOR,</span>
<span class="nc" id="L960">                            mxUtils.getHexColorString(Color.getHSBColor(1.41f, .96f, 0.50f)),</span>
                            new Object[] {nextnode});
<span class="nc" id="L962">                    graphComponent.refresh();</span>

                    // have to change icon of left tree here
<span class="nc" id="L965">                    pathToRoot.add((String) nextnode.getValue());</span>
<span class="nc" id="L966">                    JtreeToGraphConvert.nodeToRootPathVar(nextnode);</span>

<span class="nc" id="L968">                    String[] stringArray = pathToRoot.toArray(new String[0]);</span>
<span class="nc" id="L969">                    ArrayList&lt;String&gt; pathToRootRev = new ArrayList&lt;String&gt;();</span>

<span class="nc bnc" id="L971" title="All 2 branches missed.">                    for (int j = stringArray.length - 1; j &gt;= 0; j--) {</span>
<span class="nc" id="L972">                        pathToRootRev.add(stringArray[j]);</span>
                    }

<span class="nc" id="L975">                    String[] stringArrayRev = pathToRootRev.toArray(new String[0]);</span>
<span class="nc" id="L976">                    TreePath treePathForIconChange = JtreeToGraphGeneral.getTreeNodePath(stringArrayRev);</span>

<span class="nc" id="L978">                    cellListForIconChange[cellCount] = treePathForIconChange;</span>
<span class="nc" id="L979">                    cellCount++;</span>
 
<span class="nc" id="L981">                    pathToRoot.clear();</span>

<span class="nc" id="L983">                    decnum = 0;</span>
                }
            }

<span class="nc bnc" id="L987" title="All 2 branches missed.">            for (int i = 0; i &lt; outgoing.length; i++) {</span>
<span class="nc" id="L988">                Object targetCell = graph.getModel().getTerminal(outgoing[i], false);</span>
<span class="nc" id="L989">                mxCell targetCell2 = (mxCell) targetCell;</span>
<span class="nc" id="L990">                nextChildNode(targetCell2);</span>
            }
        }
<span class="nc" id="L993">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>